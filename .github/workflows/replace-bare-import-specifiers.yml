name: replace bare import specificiers
on:
    push:
        branches:
            - main
jobs:
    setup:
        runs-on: macos-latest
        steps:
            - name: set up folder
              run: |
                  cd $GITHUB_WORKSPACE
                  mkdir website
                  cd ./website
            - uses: actions/checkout@v2

    replace-ultra:
        needs: setup
        runs-on: macos-latest
        steps:
            - name: set up folder
              run: |
                  cd $GITHUB_WORKSPACE
                  mkdir ultra
                  cd ./ultra
            - uses: denoland/setup-deno@v1
              with:
                  deno-version: vx.x.x
            - uses: actions/checkout@v2
              with:
                  repository: nnmrts/ultra
            - name: Merge main -> url-imports
              uses: everlytic/branch-merge@1.1.2
              with:
                  github_token: ${{ github.token }}
                  source_ref: "main"
                  target_branch: "url-imports"
                  commit_message_template: "[Automated] Merged {source_ref} into target {target_branch}"
            - name: checkout url-imports
              uses: actions/checkout@v2
              with:
                  repository: nnmrts/ultra
                  ref: url-imports
            - name: replace bare import specificiers in files
              run: deno run -A ../website/.github/workflows/replace-bare-import-specifiers.js
            - name: git config
              run: |
                  git config user.name github-actions
                  git config user.email github-actions@github.com
            - name: stage changed files
              run: git add .
            - name: commit changed files
              run: git commit -m "replace bare import specificiers with urls"
            - name: push
              run: git push
            - name: step out
              run: cd ../
    replace:
        needs: replace-ultra
        runs-on: macos-latest
        steps:
            - name: set up folder
              run: |
                  cd $GITHUB_WORKSPACE
                  cd ./website
            - uses: denoland/setup-deno@v1
              with:
                  deno-version: vx.x.x
            - uses: actions/checkout@v2
            - name: Merge main -> url-imports
              uses: everlytic/branch-merge@1.1.2
              with:
                  github_token: ${{ github.token }}
                  source_ref: ${{ github.ref }}
                  target_branch: "url-imports"
                  commit_message_template: "[Automated] Merged {source_ref} into target {target_branch}"
            - name: checkout url-imports
              uses: actions/checkout@v2
              with:
                  ref: url-imports
            - name: replace bare import specificiers in files
              run: deno run -A ./.github/workflows/replace-bare-import-specifiers.js
            - name: git config
              run: |
                  git config user.name github-actions
                  git config user.email github-actions@github.com
            - name: stage changed files
              run: git add .
            - name: commit changed files
              run: git commit -m "replace bare import specificiers with urls"
            - name: push
              run: git push
